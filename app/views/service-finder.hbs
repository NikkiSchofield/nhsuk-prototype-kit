<h1>Find local NHS services</h1>
<div class="c-faceted-search">
  <div class="grid-row">
    <form>
      <fieldset>
        <div class="column-one-quarter c-faceted-search__facet">
          <label class="c-label" for="find_service_type">NHS service</label>
          <select class="c-text-field" id="find_service_type" name="find_service_type">
            {{#find_service_types}}
              <option value="{{value}}"{{#if isSelected}} selected{{/if}}>{{label}}</option>
            {{/find_service_types}}
          </select>
        </div>
        <div class="column-one-half c-faceted-search__input">
          <label class="c-label" for="find_service_search">Your location</label>
          <input class="c-text-field" id="find_service_search" name="find_service_search" type="text"
                 value="{{find_service_search}}">
        </div>
        <div class="column-one-quarter c-faceted-search__submit">
          <input class="c-btn c-btn--primary" value="Find services" type="submit">
        </div>
      </fieldset>
      {{#if automaticLocation}}
      <input type="hidden" name="lat" value="{{lat}}">
      <input type="hidden" name="long" value="{{long}}">
      {{/if}}
    </form>
  </div>
</div>
<h3 class="c-result-number"><strong>{{resultCount}}</strong> {{resultDescription}}</h3>
<div class="grid-row">
  <div class="column-two-thirds">
    {{#if askToSaveLocation}}
      <div id="save-location" data-user-location="{{find_service_search}}">
        {{> components/alert
          id="save-location-alert"
          title="Save time and remember this location?"
          description="Sell value lorem lean startup ipsum product acquihire technical."
          link_text="Save this location"
        }}
      </div>
    {{/if}}
    {{#if resultCount}}
      {{#results}}
      {{> components/location-result
        title=name
        title_url="#"
        address=address
        telephone=phone
        status=hours.status
        meta_status=hours.meta_status
        distance=distance
        distance_url="#"
      }}
      {{/results}}
    {{/if}}
  </div>

  <div class="column-one-third">
    <!-- IGNORE THIS IT'S JUST TO GIVE ME CONTEXT -->
    <div class="mapouter">
        <div class="gmap_canvas">
          <iframe width="600" height="500" id="gmap_canvas" src="https://maps.google.com/maps?q=Bristol%2C%20GB&t=&z=14&ie=UTF8&iwloc=&output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></div>
          <style>
          .mapouter{overflow:hidden;height:500px;width:100%;}
          .gmap_canvas {background:none!important;height:500px;width:600px;}
          </style>
      </div>
      <!-- END IGNORE -->
  </div>
</div>

<script>
var elSaveLocation = document.getElementById('save-location')

elSaveLocation.querySelector('input[type=submit]').addEventListener('click', saveLocation)
Array.prototype.forEach.call(
  elSaveLocation.querySelectorAll('a[href="#"]'),
  function (el) {
    el.addEventListener('click', refuseSaveLocation)
  }
)

function removeSaveLocation () {
  elSaveLocation.parentNode.removeChild(elSaveLocation)
}

function refuseSaveLocation () {
  document.cookie = 'saveRefused=true;path=/'
}

function saveLocation () {
  var expires = new Date()
  expires.setDate(expires.getDate() + 7)
  document.cookie = 'savedLocation=' +
                    encodeURIComponent(elSaveLocation.getAttribute('data-user-location')) +
                    ';path=/;expires=' +
                    expires.toUTCString()
  removeSaveLocation()
}
</script>
