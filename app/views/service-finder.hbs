<h1>Find local NHS services</h1>
<div class="c-faceted-search">
  <div class="o-layout">
    <form>
      <fieldset>
        <div class="o-layout__item u-width-1/4 c-faceted-search__facet">
          <label class="c-label" for="find_service_type">NHS service</label>
          <select class="c-text-field" id="find_service_type" name="find_service_type">
            {{#find_service_types}}
              <option value="{{value}}"{{#if isSelected}} selected{{/if}}>{{label}}</option>
            {{/find_service_types}}
          </select>
        </div>
        <div class="o-layout__item u-width-1/2 c-faceted-search__input">
          <label class="c-label" for="find_service_search">Your location</label>
          <input class="c-text-field" id="find_service_search" name="find_service_search" type="text"
                 value="{{find_service_search}}">
        </div>
        <div class="o-layout__item u-width-1/4 c-faceted-search__submit">
          <input class="c-btn c-btn--primary" value="Find services" type="submit">
        </div>
      </fieldset>
      {{#if automaticLocation}}
      <input type="hidden" name="lat" value="{{lat}}">
      <input type="hidden" name="long" value="{{long}}">
      {{/if}}
    </form>
  </div>
</div>
<h3 class="c-result-number"><strong>{{resultCount}}</strong> {{resultDescription}}</h3>

<div class="o-layout o-layout--full">
  <div class="o-layout__item u-width-2/3">
    {{#if askToSaveLocation}}
      <div id="save-location" data-user-location="{{find_service_search}}">
        {{> components/alert
          id="save-location-alert"
          title="Save time and remember this location?"
          description="Sell value lorem lean startup ipsum product acquihire technical."
          link_text="Save this location"
        }}
      </div>
    {{/if}}
    {{#if resultCount}}
      {{#results}}
      <div class="result" onclick="document.getElementById('gmap_canvas').src = '{{map_url}}'">
      {{> components/location-result
        title=name
        title_url=url
        address=address
        telephone=phone
        status=hours.status
        open_now=hours.open_now
        closing_soon=hours.closing_soon
        meta_status=hours.meta_status
        distance=distance
        distance_url=directions_url
      }}
      </div>
      {{/results}}
    {{/if}}
  </div>

  <div class="o-layout__item u-width-1/3">
    <!-- IGNORE THIS IT'S JUST TO GIVE ME CONTEXT -->
    <div class="mapouter">
        <div class="gmap_canvas">
          <iframe width="600" height="500" id="gmap_canvas" src="{{starting_map_url}}" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></div>
          <style>
          .mapouter{overflow:hidden;height:500px;width:100%;}
          .gmap_canvas {background:none!important;height:500px;width:600px;}
          </style>
      </div>
      <!-- END IGNORE -->
  </div>
</div>

<script>
var elSaveLocation = document.getElementById('save-location')
if (elSaveLocation) {
  elSaveLocation.querySelector('input[type=submit]').addEventListener('click', saveLocation)
}

function saveLocation () {
  var expires = new Date()
  expires.setDate(expires.getDate() + 7)
  document.cookie = 'savedLocation=' +
                    encodeURIComponent(elSaveLocation.getAttribute('data-user-location')) +
                    ';path=/;expires=' +
                    expires.toUTCString()

  elSaveLocation.parentNode.removeChild(elSaveLocation)
}
</script>
